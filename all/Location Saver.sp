/* Plugin Template generated by Pawn Studio */

#include <sourcemod>
#include <sdktools>
#define MAX_PLAYERS 64

new Float:playercords[64+1][3];
new Handle:cvarEnable;
new userused[64+1];
new Float:globalcords[3];
new savedteam[64+1];
new setglobal;

public Plugin:myinfo = 
{
	name = "Location Saver",
	author = "Aviram1994/Aviram Hassan/AviramR0X",
	description = "Saves the location of the user and lets him teleport back if he falls or get killed",
	version = "3.0",
	url = "NOURL"
}
public OnClientPutInServer(client)
{
	userused[client] = 0;
}
public Action:NotEnabled(client)
{
	PrintToChat(client,"[Location Saver] plugin isnt enabled currently.");
	return Plugin_Handled;
}
public OnPluginStart()
{
	setglobal = 0;
	RegConsoleCmd("sm_gt",Command_GlobalTeleClient, "Teleports you to the global location that was set by an admin");
	RegConsoleCmd("sm_s", Command_SaveClientLocation, "Saves your current location");
	RegConsoleCmd("sm_t", Command_TeleClient, "Teleports you to the location you saved");
	cvarEnable = CreateConVar("sm_savelocation", "0", "Enable/Disable the plugin", FCVAR_PLUGIN, true, 0.0, true, 1.0);
	CreateConVar("sm_savelocation_version", "3.00", "The Save location plugin's version", FCVAR_REPLICATED , true, 0.0, true, 1.0);
	RegAdminCmd("sm_globalsave",Command_globalsave,ADMFLAG_KICK,"Save a global location for all ppl");
	RegAdminCmd("sm_gs",Command_globalsave,ADMFLAG_KICK,"Save a global location for all ppl");
	RegAdminCmd("sm_globalremove",Command_globalremove,ADMFLAG_KICK,"Removes the global location");
	RegAdminCmd("sm_gr",Command_globalremove,ADMFLAG_KICK,"Removes the global location");

}
public Action:Command_globalremove(client,args)
{
	setglobal = 0;
	PrintToChat(client,"[Location Saver] Done");
	return Plugin_Handled
}
public Action:Command_globalsave(client, args)
{
	GetClientAbsOrigin(client,globalcords);
	setglobal = 1;
	
	return Plugin_Handled;
}
public Action:Command_GlobalTeleClient(client,args)
{
	if (!GetConVarBool(cvarEnable))
	return NotEnabled(client);
	if (setglobal)
	{
	TeleportEntity(client,globalcords,NULL_VECTOR,NULL_VECTOR);
	PrintToChat(client,"[Location Saver]You succesfuly teleported to a global location");
	}
	else
	{
	PrintToChat(client,"[Location Saver] The admin didnt set any location");
	}
	return Plugin_Handled;
}
public Action:Command_SaveClientLocation(client,args)
{
	if (!GetConVarBool(cvarEnable))
	return NotEnabled(client);
	if (IsPlayerAlive(client))
	{
	userused[client] = 1;
	GetClientAbsOrigin(client,playercords[client]);
	savedteam[client] = GetClientTeam(client);
	PrintToChat(client,"[Location Saver] You just saved your location,Use !t to get to this saved location");
	}
	else
	{
		PrintToChat(client,"[Location Saver] You cant save while you're not alive!");
	}
	return Plugin_Handled;
}
public Action:Command_TeleClient(client,args)
{
	if (userused[client] == 0)
	{
		PrintToChat(client,"[Location Saver] You didnt save any location");
		return Plugin_Handled;
	}
	if (!GetConVarBool(cvarEnable))
	return NotEnabled(client);
	if (GetClientTeam(client) != savedteam[client])
	{
		PrintToChat(client,"[Location Saver] Sorry but you cant teleport to the location you saved on the other team!");
		return Plugin_Handled;
	}
	TeleportEntity(client, playercords[client],NULL_VECTOR,NULL_VECTOR);
	return Plugin_Handled;
}