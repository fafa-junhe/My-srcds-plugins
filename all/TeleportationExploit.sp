#pragma semicolon 1
#include <sourcemod>

public Plugin:myinfo = {
	name = "Teleport Exploit Check",
	author = "Kyle Sanderson, Brian Rak",
	description = "Checks the sensitivity clientconvar for invalid values.",
	version = "1.0",
	url = "https://AlliedMods.net"
};

public OnMapStart()
{
	CreateTimer(2.5, StartTeleCheck, _, TIMER_REPEAT|TIMER_FLAG_NO_MAPCHANGE);
}

public Action:StartTeleCheck(Handle:timer)
{
	for (new i = MaxClients; i > 0; --i)
	{
		if (!IsClientInGame(i))
			continue;

		QueryClientConVar(i, "sensitivity", TeleCheckDone);
	}

	return Plugin_Continue;
}

public TeleCheckDone(QueryCookie:cookie, client, ConVarQueryResult:result, const String:cvarName[], const String:cvarValue[], any:value)
{
	if (result != ConVarQuery_Okay)
		return;

	new Float:fValue = StringToFloat(cvarValue);
	if (fValue < 1000.0)
		return;

	LogMessage("Removing client '%L' as sensitivity=%f", client, fValue);
	KickClient(client,"Please lower your sensitivity");
}
