/* Plugin Template generated by Pawn Studio */

#include <sourcemod>

public Plugin:myinfo = 
{
	name = "Connect Spam Blocker",
	author = "Acdervis",
	description = "Prevents user spamming the connect command.",
	version = "1.0",
	url = "www.xkafe.net"
}

new arrayspot = 0;
new String:StoreIP[10][20];
new IPCount = 0;
new String:reject[64];

public OnPluginStart()
{
	CreateConVar("sm_connectspam_ver", "1.0", "Version Info", FCVAR_PLUGIN|FCVAR_SPONLY|FCVAR_NOTIFY|FCVAR_REPLICATED);
}

public bool:OnClientConnect(client, String:rejectmsg[], maxlen)
{
	new String:IP[20];
	GetClientIP(client, IP, sizeof(IP));
	strcopy(StoreIP[arrayspot], sizeof(StoreIP[]), IP);
	Format(reject, sizeof(reject), "Stop spamming the server! Use Auto-connect instead.");
	Format(rejectmsg, sizeof(maxlen), "Stop spamming the server! Use Auto-connect instead.");
	
	for(new i = 1; i < 10; i++)
	{
		if(StrEqual(IP, StoreIP[i], false))
		{
			IPCount++;
			if(IPCount == 3)
			{
				BanIdentity(IP, 5, BANFLAG_IP, reject);
				return false;
			}
		}
	}
	
	new arrayholder = arrayspot;
	CreateTimer(20.0, Clear_Timer, any:arrayholder);
	IPCount = 0;
	
	if(arrayspot == 9)
	{
		arrayspot = 0;
	} else {
		arrayspot = arrayspot + 1;
	}
	return true;
}

public Action:Clear_Timer(Handle:hndl, any:arrayholder)
{
	strcopy(StoreIP[arrayholder], sizeof(StoreIP[]), "");
}